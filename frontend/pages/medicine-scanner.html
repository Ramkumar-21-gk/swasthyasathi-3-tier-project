<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Medicine Scanner & Alternatives</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<link rel="stylesheet" href="../css/medicine-scanner.css">
</head>

<body class="notranslate">

<!-- ========================= NAVBAR ========================= -->
<div id="navbar"></div>

<div class="container mt-4">

  <h2 class="fw-bold">Scan Medicine & View Details</h2>
  <p class="text-secondary">Scan or search medicine and see information, price & alternatives</p>

  <!-- Non-logged-in user warning -->
  <div id="scanLimitWarning" class="alert alert-warning alert-dismissible fade show" role="alert" style="display: none;">
    <strong>‚ö†Ô∏è Scan Limit:</strong> You have used <span id="scanCountDisplay">0</span>/3 free scans. 
    <a href="login.html" class="alert-link">Login or register</a> for unlimited scans and exclusive features!
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

  <div class="row g-4 mt-2">

    <!-- LEFT ‚Äî SCAN / SEARCH -->
    <div class="col-md-4">
      <div class="scan-box">

        <h5 class="fw-bold mb-3">Scan / Search Medicine</h5>

        <button class="btn btn-primary w-100 mb-2" onclick="openCameraCapture()">
        üì∑ Open Camera
        </button>

        <button class="btn btn-outline-primary w-100 mb-3" onclick="openGalleryPicker()">
        üñºÔ∏è Upload Prescription Image
        </button>

        <!-- Mobile Camera input -->
        <input 
        type="file" 
        id="cameraInput" 
        accept="image/*" 
        capture="environment"
        style="display:none" 
        onchange="handlePrescriptionUpload(event)"
        >

        <!-- Gallery input -->
        <input 
        type="file" 
        id="galleryInput" 
        accept="image/*" 
        style="display:none" 
        onchange="handlePrescriptionUpload(event)"
        >


        <input type="text" id="searchBox" class="form-control mb-3"
               placeholder="Search medicine name">

        <button class="btn btn-success w-100" onclick="showMedicineDetails()">
          üîé Search Medicine
        </button>

      </div>
    </div>


    <!-- RIGHT ‚Äî MEDICINE DETAILS -->
    <div class="col-md-8">

      <div class="medicine-box">

        <div class="d-flex justify-content-between align-items-center">
          <h5 class="fw-bold mb-0">Medicine Details</h5>

          <div class="d-flex gap-2">
            <!-- Back to list -->
            <button class="btn btn-sm btn-outline-secondary" id="backToListBtn" style="display:none" onclick="backToDetectedList()">
              ‚¨ÖÔ∏è Back to list
            </button>

            <!-- Language Switch -->
            <select id="langSelect"
                    class="form-select form-select-sm"
                    style="width:130px"
                    onchange="changeLanguage()"
                    >
              <option value="en">English</option>
              <option value="hi">Hindi</option>
              <option value="ur">Urdu</option>
            </select>

            <!-- Listen Button -->
            <button class="btn btn-sm btn-dark"
                    onclick="speakDetails()"
                    id="listenBtn"
                    >
              üîä Listen
            </button>

          </div>
        </div>

        <hr>

        <!-- Scrollable content -->
        <div id="detailsContent" style="display:none;">

          <h4 id="medName" class="fw-bold"></h4>

          <p id="medInfo" class="translate-me"></p>

        </div>

        <!-- Multiple results from prescription scan -->
        <div id="multiResults" style="display:none;" class="mt-3"></div>

      </div>
    </div>

  </div>


  <!-- CHEAPER ALTERNATIVES -->
  <div id="alternativesSection">
    <h4 class="fw-bold mt-5">Cheaper Medicine Alternatives</h4>
    <p class="text-secondary">Same salt ‚Äî lower price ‚Äî generic options</p>

    <div class="row g-3 mt-1" id="alternativesContainer">

      <div class="col-md-3">
        <div class="alt-card">
          <img src="https://via.placeholder.com/200x140" class="alt-img">
          <h6 class="fw-bold mt-2">Generic Paracetamol 500mg</h6>
          <p class="text-success fw-bold mb-1">‚Çπ28 (Strip of 10)</p>
          <small class="text-secondary">Cheaper alternative</small>
        </div>
      </div>

      <div class="col-md-3">
        <div class="alt-card">
          <img src="https://via.placeholder.com/200x140" class="alt-img">
          <h6 class="fw-bold mt-2">PCM Relief Tablets</h6>
          <p class="text-success fw-bold mb-1">‚Çπ32</p>
          <small class="text-secondary">Generic substitute</small>
        </div>
      </div>

      <div class="col-md-3">
        <div class="alt-card">
          <img src="https://via.placeholder.com/200x140" class="alt-img">
          <h6 class="fw-bold mt-2">ParaCare 500</h6>
          <p class="text-success fw-bold mb-1">‚Çπ30</p>
          <small class="text-secondary">Low-cost alternative</small>
        </div>
      </div>

      <div class="col-md-3">
        <div class="alt-card">
          <img src="https://via.placeholder.com/200x140" class="alt-img">
          <h6 class="fw-bold mt-2">MediPar 500</h6>
          <p class="text-success fw-bold mb-1">‚Çπ26</p>
          <small class="text-secondary">Affordable option</small>
        </div>
      </div>

    </div>
  </div>

</div>

<div id="footer"></div>
<!-- Webcam Modal -->
<div class="modal fade" id="cameraModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content" style="border-radius: 18px;">
      
      <div class="modal-header">
        <h5 class="modal-title fw-bold">üì∑ Capture Prescription</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="stopWebcam()"></button>
      </div>

      <div class="modal-body text-center">
        <video id="webcamVideo" autoplay playsinline class="w-100 rounded"></video>
        <canvas id="webcamCanvas" style="display:none;"></canvas>
      </div>

      <div class="modal-footer">
        <button class="btn btn-danger" onclick="stopWebcam()" data-bs-dismiss="modal">
          ‚ùå Close
        </button>
        <button class="btn btn-success" onclick="captureWebcamPhoto()">
          üì∏ Capture Photo
        </button>
      </div>

    </div>
  </div>
</div>

<script src="../js/auth.config.js"></script>
<script src="../js/medicine.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Load navbar and update it
  fetch("navbar.html")
    .then(res => res.text())
    .then(data => {
      document.getElementById("navbar").innerHTML = data;
      // Call updateNavbar after navbar injection
      setTimeout(() => {
        if (typeof window.updateNavbar === 'function') {
          window.updateNavbar();
        }
      }, 150);
    });
  
  fetch("footer.html")
    .then(r => r.text())
    .then(html => document.getElementById("footer").innerHTML = html);

  // Initialize scan limit UI
  function updateScanLimitUI() {
    const warning = document.getElementById('scanLimitWarning');
    const counter = document.getElementById('scanCountDisplay');
    
    if (!AuthConfig.isLoggedIn) {
      warning.style.display = 'block';
      counter.textContent = AuthConfig.scanCount;
    } else {
      warning.style.display = 'none';
    }
  }
  
  updateScanLimitUI();
  window.addEventListener('storage', updateScanLimitUI);
</script>
</script>

</body>
</html>
